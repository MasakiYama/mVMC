% !TEX root = userguide_en.tex
%----------------------------------------------------------
\chapter{{Algorithm}}
\label{Ch:algorithm}
\section{Variational MonteCalro Method}
In Variational MonteCalro (VMC) method, the importance sampling is performed in the system constructed by the Malkov chain toward the appropriate complete system.
Here, we choose the real spatial arrangement $\{| x\rangle\}$ at $S_z = 0$ as the complete system.
\begin{equation}
| x\rangle =  \prod_{n=1}^{N/2} c_{r_{n\uparrow}}^{\dag} \prod_{n=1}^{N/2} c_{r_{n\downarrow}}^{\dag} |0 \rangle,
\end{equation}
where we set $r_{n\sigma}$ as the position of $n$-th electron with $\sigma (=\uparrow \rm{or} \downarrow)$ spin.

\subsection{Importance sampling}
When the importance of Malkov chain is defined by
\begin{equation}
\rho(x)=\frac{|\langle x| \psi \rangle|^2}{\langle \psi | \psi \rangle} \ge 0, \sum{x} \rho(x)=1,
\end{equation}
the expected value of the operator $A$ is given by
\begin{equation}
\langle A \rangle =\frac{\langle \psi| A| \psi \rangle}{\langle \psi | \psi \rangle} 
=\sum_x \frac{\langle \psi| A | x\rangle \langle x| \psi \rangle}{\langle \psi |\psi \rangle} 
=\sum_x \rho(x) \frac{\langle \psi| A | x\rangle }{\langle \psi |x \rangle} .
\end{equation}
In VMC, the summation in terms of $x$ is replaced by the importance sampling.
Then, local Green's function $G_{ij\sigma\sigma'}(x)$ is defined by
\begin{equation}
G_{ij\sigma\sigma'}(x)=\frac{\langle \psi | c_{i\sigma}^{\dag} c_{j\sigma'} | \psi \rangle}{\langle \psi | x \rangle}.
\end{equation}
In mVMC, the Mersenne twister method is used for sampling as the random number generator \cite{Mutsuo2008}. 

\section{Bogoliubov representation}\label{sec_bogoliubov_rep}

In the spin system,
the spin indices in input files of \verb|transfer|, \verb|InterAll|,
and correlation functions are specified as those of the Bogoliubov representation.
Spin operators are written by using creation/annihilation operators as follows:
\begin{align}
  S_{i z} &= \sum_{\sigma = -S}^{S} \sigma c_{i \sigma}^\dagger c_{i \sigma}
  \\
  S_{i}^+ &= \sum_{\sigma = -S}^{S-1} 
  \sqrt{S(S+1) - \sigma(\sigma+1)} 
  c_{i \sigma+1}^\dagger c_{i \sigma}
  \\
  S_{i}^- &= \sum_{\sigma = -S}^{S-1} 
  \sqrt{S(S+1) - \sigma(\sigma+1)} 
  c_{i \sigma}^\dagger c_{i \sigma+1}
\end{align}

\section{Relation between Pfaffian Slater determinant and single Slater determinant}
\label{sec:PuffAndSlater}
In this section, we show relation between Pfaffian Slater determinant and single Slater determinant.
We also discuss meaning of the singular value decomposition of coefficients $f_{ij}$. 
\subsection{Relation between $f_{ij}$ and $\Phi_{in\sigma}$~(case of anti-parallel pairing)}
Pfaffian Slater determinant [one-body part of the many-variable variational Monte Carlo (mVMC) method]
is defined as
\begin{equation}
|\phi_{\rm Pf}\rangle=\Big(\sum_{i,j=1}^{N_{s}}f_{ij}c_{i\uparrow}^{\dagger}c_{j\downarrow}^{\dagger}\Big)^{N_{\rm e}/2}|0\rangle,
\end{equation}
where $N_{s}$ is number of sites, 
$N_{e}$ is number of total particles,
and $f_{ij}$ are variational parameters.
For simplicity, we assume that $f_{ij}$ are real number.
Single Slater determinant is defined as 
\begin{align}
|\phi_{\rm SL}\rangle&=\Big(\prod_{n=1}^{N_{e}/2}\psi_{n\uparrow}^{\dagger}\Big)
\Big(\prod_{m=1}^{N_{e}/2}\psi_{m\downarrow}^{\dagger}\Big)|0\rangle, \\
\psi_{n\sigma}^{\dagger}&=\sum_{i=1}^{N_{s}}\Phi_{in\sigma}c^{\dagger}_{i\sigma}.
\end{align}
We note that $\Phi$ is the normalized orthogonal basis, i.e, 
\begin{equation}
\sum_{i=1}^{N_{s}}\Phi_{in\sigma}\Phi_{im\sigma}=\delta_{nm},
\end{equation}
where $\delta_{nm}$ is the Kronecker's delta.
Due to this normalized orthogonality, we obtain 
following relation:
\begin{align}
[\psi^{\dagger}_{n\sigma},\psi_{m\sigma}]_{+}&=\delta_{nm},\\
G_{ij\sigma}=\langle c_{i\sigma}^{\dagger}c_{j\sigma}\rangle 
&=\frac{\langle \phi_{\rm SL}| c_{i\sigma}^{\dagger}c_{j\sigma} | \phi_{\rm SL}\rangle}{\langle \phi_{\rm SL}|\phi_{\rm SL}\rangle } \\
&=\sum_{n} \Phi_{in\sigma} \Phi_{jn\sigma}.
\end{align}

Here, we rewrite $\phi_{\rm SL}$ and obtain explicit 
relation between $f_{ij}$ and $\Phi_{in\sigma}$.
By using the commutation relation for $\psi^{\dagger}_{n\sigma}$,
we rewrite $\phi_{\rm SL}$ as 
\begin{align}
|\phi_{\rm SL}\rangle \propto \prod_{n=1}^{N_{e}/2}\Big(\psi_{n\uparrow}^{\dagger}\psi_{\mu(n)\downarrow}^{\dagger}\Big)|0\rangle,
\end{align}
where $\mu(n)$ represents permutation of sequence of $n= 1, 2, \cdots, N_{e}/2$.
For simplicity, we take identity permutation and obtain the relation 
\begin{align}
|\phi_{\rm SL}\rangle &\propto \prod_{n=1}^{N_{e}/2}\Big(\psi_{n\uparrow}^{\dagger}\psi_{n\downarrow}^{\dagger}\Big)|0\rangle
=\prod_{n=1}^{N_{e}/2} K_{n}^{\dagger}|0\rangle \\
&\propto\Big(\sum_{n=1}^{\frac{N_{e}}{2}}K_{n}^{\dagger}\Big)^{\frac{N_{e}}{2}} |0\rangle
=\Big(\sum_{i,j=1}^{N_{s}}\Big[\sum_{n=1}^{\frac{N_{e}}{2}}\Phi_{in\uparrow}\Phi_{jn\downarrow}\Big]
c_{i\uparrow}^{\dagger}c_{j\downarrow}^{\dagger}\Big)|0\rangle,
\end{align}
where $K_{n}^{\dagger}=\psi_{n\uparrow}^{\dagger}\psi_{n\downarrow}^{\dagger}$ and
we use the relation  $K_{n}^{\dagger}K_{m}^{\dagger}=K_{m}^{\dagger}K_{n}^{\dagger}$.
This result shows that $f_{ij}$ can be expressed by the 
coefficients of the single Slater determinant as
\begin{align}
f_{ij}=\sum_{n=1}^{\frac{N_{e}}{2}}\Phi_{in\uparrow}\Phi_{jn\downarrow}.
\end{align}
We note that this is one of expression of $f_{ij}$ for 
single Slater determinant, i.e, $f_{ij}$ depend on
the pairing degrees of freedom (choices  of $\mu(n)$) and
gauge degrees of freedom ( we can arbitrary change
the sign of $\Phi$ as $\Phi_{in\sigma}\rightarrow -\Phi_{in\sigma}$).
This large degrees of freedom is the origin of huge redundancy of
$f_{ij}$.

\subsection{Relation between $F_{IJ}$ and $\Phi_{In}$~(case of general pairing including parallel pairing)}
Here, we consider the relation between the general Pfaffian 
wave functions that include the parallel pairing and
the Slater determinant.
\begin{align}
|\phi_{\rm Pf}\rangle&=\Big(\sum_{I,J=1}^{2N_{s}}f_{IJ}c_{I}^{\dagger}c_{J}^{\dagger}\Big)^{N_{\rm e}/2}|0\rangle, \\
|\phi_{\rm SL}\rangle&=\Big(\prod_{n=1}^{N_{e}}\psi_{n}^{\dagger}\Big)|0\rangle,~~\psi_{n}^{\dagger}=\sum_{I=1}^{2N_{s}}\Phi_{In}c^{\dagger}_{I},
\end{align}
where $I,J$ denote the site index including the spin degrees of freedom.

By using the similar argument in the anti-parallel pairing case,
we obtain the following relation.
\begin{align}
F_{IJ}=\sum_{n=1}^{\frac{N_{e}}{2}}\Big(\Phi_{In}\Phi_{Jn+1}-\Phi_{Jn}\Phi_{In+1}\Big).
\end{align}
Because this relation hold for the case of anti-parallel pairing,
we employ this relation in mVMC ver 1.0.



\subsection{Singular value decomposition of $f_{ij}$}
We define matrices $F$, $\Phi_{\uparrow}$, $\Phi_{\downarrow}$, and $\Sigma$ as
\begin{align}
&(F)_{ij}=f_{ij},~~~ 
(\Phi_{\uparrow})_{in}=\Phi_{in\uparrow},~~~ 
(\Phi_{\downarrow})_{in}=\Phi_{in\downarrow}, \\
&\Sigma={\rm diag}[1,\cdots,1,0,0,0]~~~\text{({\rm \# of 1} = $N_{e}/2$)}.
\end{align}
By using these notations, we can describe the
singular value decomposition of $f_{ij}$ (or equivalently $F$) as 
\begin{align}
F=\Phi_{\uparrow}\Sigma\Phi_{\downarrow}^{t}.
\end{align}
This result indicates that $f_{ij}$ can be 
described by the mean-field solutions
if the number of
nonzero singular values are $N_{e}/2$ and
all the nonzero singular values of $F$ are one.
In other word, the singular values including their numbers
offers the quantitative criterion how the Pfaffian Slater determinant
deviates from the single Slate determinant.

\section{Power Lanczos method}
In this section, we show how to determine $\alpha$ in the power-Lanczos method. Within the finite- number sampling, it is important to use the decomposition that guarantees the positive definitive relation for variance. We also explain the calculation of physical quantities after the single-step Lanczos method.
\subsection{Determination of $\alpha$}
First, we briefly explain the sampling procedure of the variational Monte Carlo (VMC) method.
Physical properties $\hat{A}$ are calculated as follows:
\begin{align}
&\langle \hat{A}\rangle = \frac{\langle \phi| \hat{A}|\phi \rangle}{\langle \phi| \phi \rangle} = \sum_{x} \rho(x) F(x, {\hat{A}}),\\
& \rho(x)=\frac{|\langle \phi|x\rangle|^2}{\langle \phi | \phi \rangle}, ~~~~F(x,  {\hat{A}}) =  \frac{\langle x| \hat{A}|\phi \rangle}{\langle x| \phi \rangle}.
\end{align}
There are two ways to calculate the product of the operators  $\hat{A}\hat{B}$.
\begin{align}
&\langle \hat{A} \hat{B}\rangle = \sum_{x} \rho(x) F(x, {\hat{A}\hat{B}}),\\
&\langle \hat{A} \hat{B}\rangle = \sum_{x} \rho(x) F^{\dag}(x, {\hat{A})F(x, \hat{B}}).
\end{align}
As we explain later, in general, the latter way is numerical stable one. 
For example, we consider the expectation value of the variance, 
which is defined as $\sigma^2=\langle (\hat{H}-\langle \hat{H}\rangle)^2\rangle$. There are two ways to calculate the variance.
\begin{align}
&\sigma^2=\sum_{x} \rho(x) F(x,  (\hat{H}-\langle \hat{H}\rangle)^2) = \sum_{x} \rho(x) F(x,  \hat{H}^2) - \left[ \sum_{x} \rho(x) F(x,  \hat{H})\right]^2 ,\\
&\sigma^2=\sum_{x} \rho(x) F^{\dag}(x,  \hat{H}-\langle \hat{H}\rangle)F(x,  \hat{H}-\langle \hat{H}\rangle) = \sum_{x} \rho(x) F^{\dag}(x,  \hat{H}) F(x, \hat{H})- \left[ \sum_{x} \rho(x) F(x,  \hat{H})\right]^2 
\end{align}
From its definition, the latter way gives the positive definitive variance even for the finite sampling while the former way does not guarantee the positive definitiveness of the variance. Here, we consider the expectation values of energy and variance for the (single-step) power Lanczos wave function $|\phi\rangle =(1+\alpha \hat{H}) |\psi \rangle$. The energy is calculated as
\begin{align}
E_{LS}(\alpha) =\frac{\langle \phi| \hat{H} |\phi\rangle}{\langle \phi|\phi\rangle}=\frac{h_1 + \alpha(h_{2(20)} + h_{2(11)}) + \alpha^2 h_{3(12)}}{1 + 2\alpha h_1 + \alpha^2 h_{2(11)}},
\end{align}
where we define $h_1$, $h_{2(11)},~h_{2(20)},$ and $h_{3(12)}$ as
\begin{align}
&h_1 =\sum_{x} \rho(x) F^{\dag}(x,  \hat{H}),\\
&h_{2(11)}=\sum_{x} \rho(x) F^{\dag}(x,  \hat{H}) F(x, \hat{H}),\\
&h_{2(20)}=\sum_{x} \rho(x) F^{\dag}(x,  \hat{H}^2),\\
&h_{3(12)}=\sum_{x} \rho(x) F^{\dag}(x,  \hat{H})F(x,  \hat{H}^2).
\end{align}
From the condition $\frac{\partial E_{LS}(\alpha)}{\partial \alpha}=0$, i.e., by solving the quadratic equations, we can determine the
 $\alpha$. The variance is calculate in the similar way.
\subsection{Calculation of physical quantities}
 By using the optimized parameter $\alpha$, we can calculate the expected value of the operator $\hat{A}$ as 
\begin{align}
A_{LS}(\alpha) =\frac{\langle \phi| \hat{A} |\phi\rangle}{\langle \phi|\phi\rangle}=\frac{A_0 + \alpha(A_{1(10)} + A_{1(01)}) + \alpha^2 A_{2(11)}}{1 + 2\alpha h_1 + \alpha^2 h_{2(11)}},
\end{align}
where we define $A_0$, $A_{1(10)},~A_{1(01)},$ and $A_{2(11)}$ as
\begin{align}
&A_0 =\sum_{x} \rho(x) F(x,  \hat{A}),\\
&A_{1(10)}=\sum_{x} \rho(x) F^{\dag}(x,  \hat{H}) F(x, \hat{A}),\\
&A_{1(01)}=\sum_{x} \rho(x) F(x, \hat{A}\hat{H}),\\
&A_{2(11)}=\sum_{x} \rho(x) F^{\dag}(x,  \hat{H})F(x,  \hat{A}\hat{H}).
\end{align}

%----------------------------------------------------------
